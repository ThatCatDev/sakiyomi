---
interface Props {
  id: string;
  title: string;
  description?: string;
  size?: 'sm' | 'md' | 'lg';
}

const {
  id,
  title,
  description,
  size = 'sm',
} = Astro.props;

const sizeClasses = {
  sm: 'max-w-sm',
  md: 'max-w-md',
  lg: 'max-w-lg',
};
---

<div
  id={id}
  class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 modal-backdrop"
>
  <div class={`bg-slate-800 rounded-2xl p-6 border border-slate-700 w-full mx-4 modal-content ${sizeClasses[size]}`}>
    <h2 class="text-xl font-semibold text-white mb-2">{title}</h2>
    {description && <p class="text-slate-400 mb-6">{description}</p>}
    <slot />
  </div>
</div>

<script define:vars={{ id }}>
  // Helper functions attached to window for this modal
  window[`open_${id}`] = function() {
    const modal = document.getElementById(id);
    modal?.classList.remove('hidden', 'closing');
  };

  window[`close_${id}`] = function() {
    const modal = document.getElementById(id);
    modal?.classList.add('closing');
    setTimeout(() => {
      modal?.classList.add('hidden');
      modal?.classList.remove('closing');
    }, 150);
  };

  // Set up backdrop click and escape key handlers
  const modal = document.getElementById(id);

  modal?.addEventListener('click', (e) => {
    if (e.target === modal) {
      window[`close_${id}`]();
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !modal?.classList.contains('hidden')) {
      window[`close_${id}`]();
    }
  });
</script>
