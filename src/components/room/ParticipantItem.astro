---
import type { Participant, VotingStatus } from '../../lib/room/types';

interface Props {
  participant: Participant;
  isCurrentUser: boolean;
  votingStatus: VotingStatus;
  canPromote?: boolean;
  canDemote?: boolean;
  canKick?: boolean;
}

const { participant, isCurrentUser, votingStatus, canPromote = false, canDemote = false, canKick = false } = Astro.props;

const initial = participant.name.charAt(0).toUpperCase();
const hasVote = !!participant.current_vote;
const showVoteValue = votingStatus === 'revealed' && participant.current_vote;
---

<li
  class="flex items-center gap-3 p-2 rounded-lg hover:bg-slate-800/50"
  data-participant-id={participant.id}
  data-participant-role={participant.role}
>
  <div class="relative flex-shrink-0">
    <div class="w-8 h-8 bg-indigo-600/80 rounded-full flex items-center justify-center">
      <span class="text-white text-sm font-medium participant-initial">
        {initial}
      </span>
    </div>
    <!-- Vote indicator -->
    <div
      class:list={[
        'absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-slate-900 flex items-center justify-center text-[10px] font-bold vote-indicator',
        hasVote ? 'bg-green-500 text-white' : 'bg-slate-600 text-slate-400'
      ]}
      data-has-vote={hasVote ? 'true' : 'false'}
      data-vote={participant.current_vote || ''}
    >
      {showVoteValue ? (
        <span class="vote-value">{participant.current_vote}</span>
      ) : hasVote ? (
        <svg class="w-2.5 h-2.5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
        </svg>
      ) : (
        <span>?</span>
      )}
    </div>
  </div>

  <div class="flex-1 min-w-0">
    <span class="text-white text-sm truncate block participant-name">{participant.name}</span>
    {participant.role === 'manager' && (
      <span class="text-xs text-indigo-400">Manager</span>
    )}
  </div>

  {isCurrentUser && (
    <span class="text-xs text-slate-500">(you)</span>
  )}

  {canPromote && (
    <button
      class="promote-btn p-1 text-slate-400 hover:text-indigo-400 transition-colors"
      title="Make manager"
      data-participant-id={participant.id}
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
      </svg>
    </button>
  )}

  {canDemote && (
    <button
      class="demote-btn p-1 text-slate-400 hover:text-red-400 transition-colors"
      title={isCurrentUser ? "Step down as manager" : "Remove manager"}
      data-participant-id={participant.id}
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    </button>
  )}

  {canKick && (
    <button
      class="kick-btn p-1 text-slate-400 hover:text-red-400 transition-colors"
      title="Remove from room"
      data-participant-id={participant.id}
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  )}
</li>
