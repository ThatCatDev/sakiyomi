---
import Modal from '../ui/Modal.astro';

interface Props {
  roomName: string;
  showVotes: boolean;
  voteOptions: string[];
  isManager: boolean;
}

const { roomName, showVotes, voteOptions, isManager } = Astro.props;

// Preset vote option sets
const presets = [
  { name: 'Fibonacci', values: ['0', '1', '2', '3', '5', '8', '13', '21', '?', '☕'] },
  { name: 'T-Shirt Sizes', values: ['XS', 'S', 'M', 'L', 'XL', '?', '☕'] },
  { name: 'Powers of 2', values: ['1', '2', '4', '8', '16', '32', '?', '☕'] },
  { name: 'Simple', values: ['1', '2', '3', '4', '5', '?', '☕'] },
];
---

<Modal id="settings-modal" title="Room Settings" size="md" showCloseButton>
  <!-- Content -->
  <div class="space-y-6">
      <!-- Room Name -->
      <div>
        <label for="settings-room-name" class="block text-sm font-medium text-slate-300 mb-2">
          Room Name
        </label>
        <input
          type="text"
          id="settings-room-name"
          value={roomName}
          disabled={!isManager}
          class="w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white text-sm placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"
        />
        {!isManager && <p class="text-xs text-slate-500 mt-1">Only the manager can change the room name</p>}
      </div>

      <!-- Show Votes Toggle -->
      <div>
        <label class="flex items-center justify-between cursor-pointer group">
          <div>
            <span class="text-sm font-medium text-slate-300 group-hover:text-white transition-colors">Show vote indicators</span>
            <p class="text-xs text-slate-500 mt-0.5" id="settings-show-votes-description">
              {showVotes ? 'Vote indicators visible in sidebar' : 'Vote indicators hidden in sidebar'}
            </p>
          </div>
          <div class="relative">
            <input
              type="checkbox"
              id="settings-show-votes"
              class="sr-only peer"
              checked={showVotes}
              disabled={!isManager}
            />
            <div class="w-9 h-5 bg-slate-600 rounded-full peer peer-checked:bg-indigo-600 peer-focus:ring-2 peer-focus:ring-indigo-500 peer-disabled:opacity-50 transition-colors"></div>
            <div class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-4"></div>
          </div>
        </label>
      </div>

      <!-- Vote Options -->
      <div>
        <label class="block text-sm font-medium text-slate-300 mb-2">
          Vote Options
        </label>

        {isManager && (
          <!-- Presets -->
          <div class="flex flex-wrap gap-2 mb-3">
            {presets.map((preset) => (
              <button
                type="button"
                class="preset-btn px-2 py-1 text-xs bg-slate-700 hover:bg-slate-600 text-slate-300 rounded transition-colors"
                data-preset={JSON.stringify(preset.values)}
              >
                {preset.name}
              </button>
            ))}
          </div>
        )}

        <!-- Current options display -->
        <div id="vote-options-display" class="flex flex-wrap gap-2 p-3 bg-slate-900 rounded-lg border border-slate-600 min-h-[60px]">
          {voteOptions.map((option) => (
            <span
              class="vote-option-tag inline-flex items-center gap-1 px-2 py-1 bg-slate-700 text-white text-sm rounded"
              data-value={option}
            >
              {option}
              {isManager && (
                <button type="button" class="remove-option-btn text-slate-400 hover:text-red-400 transition-colors">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              )}
            </span>
          ))}
        </div>

        {isManager && (
          <!-- Add new option -->
          <div class="flex gap-2 mt-2">
            <input
              type="text"
              id="new-vote-option"
              placeholder="Add option..."
              maxlength="5"
              class="flex-1 px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white text-sm placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"
            />
            <button
              type="button"
              id="add-option-btn"
              class="px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white text-sm rounded-lg transition-colors"
            >
              Add
            </button>
          </div>
        )}

        {!isManager && <p class="text-xs text-slate-500 mt-2">Only the manager can change vote options</p>}
      </div>
    </div>

    <!-- Footer -->
    <div class="flex justify-end gap-2 pt-4 border-t border-slate-700 mt-6">
      <button
        id="cancel-settings-btn"
        class="px-4 py-2 text-slate-300 hover:text-white text-sm transition-colors"
      >
        Cancel
      </button>
      {isManager && (
        <button
          id="save-settings-btn"
          class="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium rounded-lg transition-colors"
        >
          Save Changes
        </button>
      )}
    </div>
  </div>
</Modal>
